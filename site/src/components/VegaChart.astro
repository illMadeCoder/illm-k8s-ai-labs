---
interface Props {
  spec: object;
}

const { spec } = Astro.props;
---

<div class="chart-container">
  <div class="vega-chart" data-spec={JSON.stringify(spec)}></div>
</div>

<script>
  import vegaEmbed from 'vega-embed';

  document.querySelectorAll<HTMLElement>('.vega-chart').forEach((el) => {
    const raw = el.getAttribute('data-spec');
    if (!raw) return;
    try {
      const spec = JSON.parse(raw);
      vegaEmbed(el, spec, { actions: false, renderer: 'svg' });
    } catch (e) {
      el.textContent = `Chart error: ${e}`;
    }
  });
</script>
