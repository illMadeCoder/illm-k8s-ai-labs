---
import type { TutorialServiceDef } from '../types';

interface Props {
  services: TutorialServiceDef[];
}

const { services } = Astro.props;

const iconSvgs: Record<string, string> = {
  database: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="16" height="16"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></svg>',
  globe: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="16" height="16"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>',
  terminal: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="16" height="16"><polyline points="4 17 10 11 4 5"/><line x1="12" y1="19" x2="20" y2="19"/></svg>',
  shield: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="16" height="16"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>',
  key: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="16" height="16"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"/></svg>',
};
---

<div class="service-links-panel">
  <span class="service-links-label">Services</span>
  <div class="service-links">
    {services.map((svc) => {
      const iconHtml = iconSvgs[svc.icon || ''] || iconSvgs.globe;
      return svc.url ? (
        <a href={svc.url} target="_blank" rel="noopener noreferrer" class="service-link">
          <span class="service-icon" set:html={iconHtml} />
          <span class="service-name">{svc.label}</span>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
               stroke-linecap="round" stroke-linejoin="round" width="10" height="10" class="service-external">
            <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
            <polyline points="15 3 21 3 21 9"/>
            <line x1="10" y1="14" x2="21" y2="3"/>
          </svg>
        </a>
      ) : (
        <span class="service-link service-link-disabled" title="Requires running experiment">
          <span class="service-icon" set:html={iconHtml} />
          <span class="service-name">{svc.label}</span>
        </span>
      );
    })}
  </div>
</div>

<style>
  .service-links-panel {
    padding: 0.75rem 1rem;
    border-bottom: 1px solid var(--border);
  }

  .service-links-label {
    display: block;
    font-size: 0.7rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.04em;
    color: var(--text-muted);
    margin-bottom: 0.5rem;
  }

  .service-links {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .service-link {
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
    padding: 0.35rem 0.75rem;
    font-size: 0.8rem;
    font-weight: 600;
    color: var(--text);
    background: var(--bg-surface);
    border: 1px solid var(--border);
    border-radius: 999px;
    text-decoration: none;
    transition: border-color 0.15s, background 0.15s;
    cursor: pointer;
  }

  .service-link:hover {
    border-color: #e879f9;
    background: color-mix(in srgb, #e879f9 8%, var(--bg-surface));
    color: var(--text);
    text-decoration: none;
  }

  .service-link-disabled {
    opacity: 0.5;
    cursor: default;
  }

  .service-link-disabled:hover {
    border-color: var(--border);
    background: var(--bg-surface);
  }

  .service-icon {
    display: flex;
    align-items: center;
    color: #e879f9;
  }

  .service-link-disabled .service-icon {
    color: var(--text-muted);
  }

  .service-name {
    white-space: nowrap;
  }

  .service-external {
    color: var(--text-muted);
    opacity: 0.6;
  }

  @media (max-width: 640px) {
    .service-links-panel {
      padding: 0.5rem 0.75rem;
    }
  }
</style>
