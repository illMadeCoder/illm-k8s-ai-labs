# IngressRoutes for observability services
#
# All accessible via Tailscale at hub.tailnet.ts.net/servicename

apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: grafana
  namespace: traefik
spec:
  entryPoints:
    - web
  routes:
    - match: PathPrefix(`/grafana`)
      kind: Rule
      services:
        - name: grafana
          namespace: observability
          port: 80
      middlewares:
        - name: strip-grafana
---
apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: mimir
  namespace: traefik
spec:
  entryPoints:
    - web
  routes:
    - match: PathPrefix(`/mimir`)
      kind: Rule
      services:
        - name: mimir-gateway
          namespace: observability
          port: 80
      middlewares:
        - name: strip-mimir
---
apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: loki
  namespace: traefik
spec:
  entryPoints:
    - web
  routes:
    - match: PathPrefix(`/loki`)
      kind: Rule
      services:
        - name: loki-gateway
          namespace: observability
          port: 80
      middlewares:
        - name: strip-loki
---
apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: tempo
  namespace: traefik
spec:
  entryPoints:
    - web
  routes:
    - match: PathPrefix(`/tempo`)
      kind: Rule
      services:
        - name: tempo
          namespace: observability
          port: 3100
      middlewares:
        - name: strip-tempo
---
apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: argocd
  namespace: traefik
spec:
  entryPoints:
    - web
  routes:
    - match: PathPrefix(`/argocd`)
      kind: Rule
      services:
        - name: argocd-server
          namespace: argocd
          port: 80
      middlewares:
        - name: strip-argocd
---
apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: openbao
  namespace: traefik
spec:
  entryPoints:
    - web
  routes:
    - match: PathPrefix(`/openbao`)
      kind: Rule
      services:
        - name: openbao
          namespace: openbao
          port: 8200
      middlewares:
        - name: strip-openbao
---
# Root path shows Traefik dashboard
apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: root
  namespace: traefik
spec:
  entryPoints:
    - web
  routes:
    - match: Path(`/`)
      kind: Rule
      services:
        - name: api@internal
          kind: TraefikService
