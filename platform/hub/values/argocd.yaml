# ArgoCD values for Talos hub (GitOps-managed)
#
# This is the ongoing config - changes here are synced by ArgoCD.
# The bootstrap values file is only used for initial install.
#
# ENVIRONMENT CONFIG: kube-vip pool 192.168.1.240-250
#   - values/dns-stack.yaml (loadBalancerIP)
#   - values/openbao.yaml (loadBalancerIP)
#   - platform/hub/bootstrap/argocd-values-talos.yaml (loadBalancerIP)

server:
  podLabels:
    app.kubernetes.io/instance: argocd
  service:
    type: LoadBalancer
    # kube-vip pool: DNS=.240, ArgoCD=.241, OpenBao=.242
    loadBalancerIP: 192.168.1.241

  # Use internal TLS certificate (issued by OpenBao internal CA)
  # Includes SANs for both external domain and internal service names
  certificate:
    enabled: false  # We manage cert via cert-manager, not ArgoCD
  certificateSecret:
    enabled: true
    name: argocd-server-internal-tls  # Created by cert-manager from OpenBao PKI

# Webhook Configuration
# For local development, webhook secret is optional (smee.io URL is obscure enough)
# To enable: configure same secret in GitHub webhook settings and uncomment below
# configs:
#   secret:
#     githubSecret: "your-shared-secret"

# Fix: Add instance label to all components (required by service selectors)
# See: illm-k8s-ai-lab-vek
controller:
  podLabels:
    app.kubernetes.io/instance: argocd

repoServer:
  podLabels:
    app.kubernetes.io/instance: argocd

applicationSet:
  podLabels:
    app.kubernetes.io/instance: argocd

notifications:
  podLabels:
    app.kubernetes.io/instance: argocd

redis:
  podLabels:
    app.kubernetes.io/instance: argocd

dex:
  podLabels:
    app.kubernetes.io/instance: argocd
