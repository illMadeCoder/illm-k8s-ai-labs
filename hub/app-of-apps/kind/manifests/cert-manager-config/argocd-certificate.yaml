# TLS Certificate for ArgoCD (Let's Encrypt)
#
# Issues certificate via Let's Encrypt using Cloudflare DNS-01 challenge.
# Outputs to a staging secret (argocd-server-tls-letsencrypt).
#
# The actual argocd-server-tls secret is managed by External Secrets,
# which syncs from OpenBao. This avoids hitting Let's Encrypt rate limits
# on cluster recreation.
#
# Workflow:
#   1. cert-manager issues to argocd-server-tls-letsencrypt
#   2. Run: task kind:cert:backup - copies to OpenBao
#   3. ESO syncs OpenBao -> argocd-server-tls (used by ArgoCD)

apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  name: argocd-server-tls-letsencrypt
  namespace: argocd
spec:
  # Staging secret - not used directly by ArgoCD
  secretName: argocd-server-tls-letsencrypt

  dnsNames:
    - argocd.illmlab.xyz

  issuerRef:
    name: letsencrypt-prod
    kind: ClusterIssuer
